
****************************************************************************************
Index Admission:
Discharged from non-federal acute care hospitals
Without an in-hospital death
Not transferred to another acute care facility
Not Discharged against medical advice
Not Admitted for primary psychiatric diagnoses
Not Admitted for rehabilitation 
Not Admitted for medical treatment of cancer 
*****************************************************************************************;
libname data 'C:\data\Data\Medicare\CCS\Data';

*Match CCS;
proc import datafile="C:\data\Projects\Hartford\Data\CCSICD9" dbms=xlsx out=CCSICD9 replace;getnames=yes;run;
data data.ccsICD92015;
set ccsICD9;
icd9_1=scan(icd9,1,"'");
ccs_1=scan(ccs,1,"'");
description_1=scan(description,1,"'");
drop icd9 ccs description;
rename icd9_1=icd9 ccs_1=dxccs description_1=dxdescription;
run;
proc import datafile="C:\data\Projects\Hartford\Data\CCSHCPCS" dbms=xlsx out=ccsProc replace;getnames=yes;run;
data ccsProc;
set ccsProc;
Proc=scan(HCPCS,1,"'");
ccs_1=scan(ccs,1,"'");
description_1=scan(description,1,"'");
drop HCPCS ccs description;
rename ccs_1=Procccs description_1=Procdescription;
run;

proc sql;
create table temp2013_4 as
select a.*,b.*
from temp2013_3 a left join ccsICD9 b
on a.PRNCPAL_DGNS_CD=b.icd9;
quit;

data temp2013_5 ;
set temp2013_4;
if  dxccs not in ('650','651','652','654','655','656','657','658','659','662','670') 
and dxccs not in ('11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40','41','42','43','44','45')
and dxccs not in ('254');

run;


***********************************************
PLanned Readmission

*Exclude Planned Readmission p62 ;
* http://altarum.org/sites/default/files/uploaded-publication-files/Rdmsn_Msr_Updts_HWR_0714_0.pdf;
***********************************************;
proc sql;
create table Planned12013 as
select bene_id,clm_id
from temp2013_5 
where  ICD_PRCDR_CD1 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD2 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD3 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD4 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD5 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD6 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD7 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD8 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD9 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD10 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD11 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD12 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD13 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD14 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD15 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD16 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD17 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD18 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD19 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD20 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD21 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD22 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD23 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD24 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'))
or ICD_PRCDR_CD25 in (select Proc from CCSProc where Procccs in ('64','105','134','135','176'));
quit;

proc sql;
create table Planned22013 as
select bene_id,clm_id
from temp2013_5 
where  ICD_PRCDR_CD1 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD2 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD3 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD4 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD5 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD6 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD7 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD8 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD9 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD10 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD11 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD12 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD13 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD14 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD15 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD16 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD17 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD18 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD19 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD20 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD21 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD22 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD23 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD24 in (select Proc from CCSProc where Procccs in ('45','194','196','254'))
or ICD_PRCDR_CD25 in (select Proc from CCSProc where Procccs in ('45','194','196','254'));
quit;


proc sql;
create table Planned32013 as
select bene_id,clm_id
from temp2013_5 
where  (
ICD_PRCDR_CD1 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD2 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD3 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD4 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD5 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD6 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD7 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD8 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD9 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD10 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD11 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD12 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD13 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD14 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD15 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD16 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD17 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD18 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD19 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD20 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD21 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD22 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD23 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD24 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD25 in (select Proc from CCSProc where Procccs in ('3','5','9','10','12','33','36','38','40','43','44','45','47','48','49','51','52','53','55','56','59','62','67','74','78','79','84','85','86','99','104','106','107','109','112','113','114','119','120','124','129','132','142','152','153','154','157','158','159','166','167','169','170','172'))
or ICD_PRCDR_CD1 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD2 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD3 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD4 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD5 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD6 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD7 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD8 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD9 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD10 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD11 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD12 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD13 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD14 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD15 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD16 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD17 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD18 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD19 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD20 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD21 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD22 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD23 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD24 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
or ICD_PRCDR_CD25 in ('301','3029','303','304','3174','346','3818','5503','5504','9426','9427')
)
and (
dxccs not in ('1','2','3','4','5','7','8','9','54','55','60','61','63','76','77','78','82','83','84','85','87','89','90','91','92','93','99','100','102','104','107','109','112','116','118','120','122','123','124','125',
'126','127','128','129','130','131','135','137','139','140','142','145','146','148','153','154','157','159','165','168','172','197','198','225','226','227','228','229','230','232','233','234','235','237','238','239','240','241','242','243',
'244','245','246','247','249','250','251','252','253','259','650','651','653','656','658','660','661','662','663','670')
and PRNCPAL_DGNS_CD not in ('03282','03640','03641','03642', '03643', '07420', '07421','07422', '07423','11281', '11503', '11504', '11513',  '11514',  '11593',  
'11594', '1303','3910','3911','3912','3918','3919','3920','3980','39890','39899','4200','42090', '42091',  '42099',  
'4210', '4211', '4219','4220','42290', '42291', '42292', '42293', '42299',  '4230','4231','4232', '4233', '4290','4260', 
'42610','42611','42612','42613','4262','4263','4264','42650','42651','42652','42653','42654', '4266', '4267',  
'42681','42682','4269','4272','7850','42789','4279','42769','39891','4280','4281','42820','42821','42823',  
'42830','42831','42833','42840', '42841', '42843','4289','5740', '57400','57401','5743', '57430','57431','5746', 
'57460', '57461', '5748', '57480','57481','5750','57512','5761','5770' )
);
quit;

data Planned2013;
set Planned12013 Planned22013 Planned32013 ;
planned=1;
proc sort nodupkey;by bene_id clm_id;
run;

proc sql;
create table temp2013_6 as
select a.*,b.planned
from temp2013_5  a left join Planned2013 b
on a.bene_id=b.bene_id and a.clm_id=b.clm_id;
quit;

proc sort data=temp2013_6;by bene_id ADMSN_DT DSCHRGDT;run;

******************************************************
30-day all-cause unplanned readmission
*****************************************************;
data temp2013_7;
set temp2013_6;

if 0<=gap<=30 and planned=. then 





